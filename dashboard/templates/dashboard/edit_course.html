{% extends "dashboard/base.html" %}
{% load i18n %}

{% block title %}{% trans "تعديل الدورة" %}: {{ form.instance.title }}{% endblock %}

{% block content %}
  <div class="container mt-4">
    <h2 class="mb-4">{% trans "تعديل الدورة" %}: {{ form.instance.title }}</h2>

    <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
      {% csrf_token %}
      {{ form.non_field_errors }}

      <div class="card mb-4">
        <div class="card-header bg-primary text-white">
          {% trans "بيانات الدورة" %}
        </div>
        <div class="card-body">
          <div class="mb-3">
            {{ form.title.label_tag }}
            {{ form.title }}
            {% if form.title.errors %}
              <div class="text-danger">{{ form.title.errors|striptags }}</div>
            {% endif %}
          </div>

          <div class="mb-3">
            {{ form.description.label_tag }}
            {{ form.description }}
            {% if form.description.errors %}
              <div class="text-danger">{{ form.description.errors|striptags }}</div>
            {% endif %}
          </div>

          <div class="mb-3">
            {{ form.price.label_tag }}
            {{ form.price }}
            {% if form.price.errors %}
              <div class="text-danger">{{ form.price.errors|striptags }}</div>
            {% endif %}
          </div>

          <div class="form-check mb-3">
            {{ form.is_published }}
            {{ form.is_published.label_tag }}
            {% if form.is_published.errors %}
              <div class="text-danger">{{ form.is_published.errors|striptags }}</div>
            {% endif %}
          </div>

          <div class="mb-3">
            {{ form.image.label_tag }}
            {{ form.image }}
            {% if form.image.errors %}
              <div class="text-danger">{{ form.image.errors|striptags }}</div>
            {% endif %}
            {% if form.instance.image %}
              <div class="mt-2">
                <label class="form-label d-block">{% trans "الصورة الحالية" %}</label>
                <img src="{{ form.instance.image.url }}" alt="Course Image" class="img-thumbnail" style="max-width: 200px;">
              </div>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="card mb-4">
        <div class="card-header bg-info text-white">
          {% trans "تعديل الدروس" %}
        </div>
        <div class="card-body">
          {{ formset.management_form }}
          {% for form in formset.forms %}
            <div class="border rounded p-3 mb-3 bg-light">
              <h6 class="mb-3">{% trans "درس" %} {{ forloop.counter }}</h6>
              {{ form.as_p }}
              {% if form.instance.pk %}
                <input type="hidden" name="{{ form.prefix }}-id" value="{{ form.instance.pk }}">
              {% endif %}
              {% if formset.can_delete %}
                <div class="form-check mt-2">
                  {{ form.DELETE }} <label class="form-check-label">{% trans "حذف هذا الدرس" %}</label>
                </div>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      </div>

      <button type="submit" class="btn btn-success">💾 {% trans "حفظ التعديلات" %}</button>
      <a href="{% url 'dashboard:course_list' %}" class="btn btn-secondary">{% trans "إلغاء" %}</a>
    </form>
  </div>
{% endblock %}
